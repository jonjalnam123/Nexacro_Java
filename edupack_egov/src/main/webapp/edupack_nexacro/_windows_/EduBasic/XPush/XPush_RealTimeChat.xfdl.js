(function(){return function(){if(!this._is_form){return;}var _a=null;this.on_create=function(){this.set_name("xpushSendRecieve");this.set_titletext("playnexacro Chat");if(Form==this.constructor){this._setFormPosition(420,470);}_a=new Dataset("dsReceive",this);_a._setContents("<ColumnInfo><Column id=\"TOPIC_ID\" type=\"STRING\" size=\"256\"/><Column id=\"TOPIC_TYPE\" type=\"STRING\" size=\"256\"/><Column id=\"MSG\" type=\"STRING\" size=\"256\"/><Column id=\"USER\" type=\"STRING\" size=\"256\"/></ColumnInfo>");this.addChild(_a.name,_a);_a=new Dataset("dsUserList",this);_a._setContents("<ColumnInfo><Column id=\"TOPIC_ID\" type=\"STRING\" size=\"256\"/><Column id=\"TOPIC_TYPE\" type=\"STRING\" size=\"256\"/><Column id=\"USER\" type=\"STRING\" size=\"256\"/></ColumnInfo>");this.addChild(_a.name,_a);_a=new XPush("XPush00",this);this.addChild(_a.name,_a);_a=new Edit("edtSendMsg","12","429",null,"27","115",null,null,null,null,null,this);_a.set_taborder("2");_a.set_imemode("hangul,full");_a.set_autoselect("true");this.addChild(_a.name,_a);_a=new Edit("edtLoginUserID","125","85",null,"27","117",null,null,null,null,null,this);_a.set_taborder("0");this.addChild(_a.name,_a);_a=new Button("btnOk",null,"85","92","27","14",null,null,null,null,null,this);_a.set_taborder("1");_a.set_text("OK");_a.set_font("normal 12px/normal \"Verdana\"");this.addChild(_a.name,_a);_a=new Static("sta00_00","12","86","113","27",null,null,null,null,null,null,this);_a.set_taborder("8");_a.set_text("XPUSH Login ID");_a.set_font("12px \"Verdana\"");this.addChild(_a.name,_a);_a=new Button("btnSend",null,"429","92","27","14",null,null,null,null,null,this);_a.set_taborder("3");_a.set_text("SEND");_a.set_font("normal 12px/normal \"Verdana\"");this.addChild(_a.name,_a);_a=new Static("staID","12","9","113","27",null,null,null,null,null,null,this);_a.set_taborder("6");_a.set_text("Project Name");_a.set_background("");_a.set_padding("");_a.set_font("12px \"Verdana\"");this.addChild(_a.name,_a);_a=new Edit("edtProjectName","125","10",null,"27","15",null,null,null,null,null,this);_a.set_taborder("5");_a.set_value("TOBE_EDU");_a.set_font("12px \"Verdana\"");_a.set_text("TOBE_EDU");this.addChild(_a.name,_a);_a=new Static("Static00_00","12","47","113","27",null,null,null,null,null,null,this);_a.set_taborder("7");_a.set_text("Address:Port");_a.set_font("12px \"Verdana\"");this.addChild(_a.name,_a);_a=new Edit("edtAddressPort","125","47",null,"27","15",null,null,null,null,null,this);_a.set_taborder("4");_a.set_font("12px \"Verdana\"");_a.set_value("tcp://localhost:50001, http://localhost:50001");_a.set_text("tcp://localhost:50001, http://localhost:50001");this.addChild(_a.name,_a);_a=new Div("divContents","12","120",null,"300","15",null,null,null,null,null,this);_a.set_taborder("9");_a.set_border("1px solid #d5d5d5");this.addChild(_a.name,_a);_a=new Layout("default","",0,0,this.divContents.form,function(_b){});this.divContents.form.addLayout(_a.name,_a);_a=new Layout("default","",420,470,this,function(_b){});_a.set_mobileorientation("landscape");this.addLayout(_a.name,_a);};this.loadPreloadList=function(){};this.registerScript("XPush_RealTimeChat.xfdl",function(){this.form_onload=function(_a,_b){if((nexacro._OS=="Android"||nexacro._OS=="iOS")&&(nexacro._Browser=="Runtime")){this.XPush00.set_layouturl("%USERAPP%XPushUrl/XPush_Message_Layout.xml");}else{this.XPush00.set_layouturl("XPushUrl::XPush_Message_Layout.xml");}this.XPush00.serviceUrl='SvcXpushURL::Service_ProviderChat.jsp';var _c=system.navigatorname;if(_c.indexOf("nexacro")> -1){this.edtAddressPort.set_value("tcp://localhost:50001");}else{this.edtAddressPort.set_value("http://localhost:50000");}};this.fnPushCallback=function(_b,_c,_d,_e,_f,_g){if(_f=="PUSH"){this.fnReceiveMessage(_b);}};this.fnPushUserCallback=function(_b,_c,_d,_e,_f,_g){if(_f=="PUSH"){var _h=this.dsUserList.getColumn(_b,'USER');if(_h==this.XPush00.userid){this.createMessage('login',_h+"님이 대화에 참여합니다.");}else{this.createMessage('receive',_h+"님이 대화에 참여합니다.");}}};this.fnCallBack=function(_b,_c,_d){if(_c>=0){}else{}};this.fnCallProvider=function(_b,_c){if(_c=='login'){this.transaction("sendUserId",this.XPush00.serviceUrl,"","",_b,"fnCallBack");}else if(_c=='send'){this.transaction("sendMassage",this.XPush00.serviceUrl,"","",_b,"fnCallBack");}};this.btnOk_onclick=function(_a,_b){this.fnPushConnect();};this.btnSend_onclick=function(_a,_b){this.fnSendMessage();};this.edtLoginUserID_onkeydown=function(_a,_b){if(_b.keycode==13){this.fnPushConnect();}};this.edtSendMsg_onkeydown=function(_a,_b){if(_b.keycode==13){this.fnSendMessage();}};this.XPush00_onsuccess=function(_a,_b){if(_b.action==0){this.fnLoginMessage();}};this.XPush00_onerror=function(_a,_b){if(_b.action==0){alert(_b.errormsg);this.edtLoginUserID.setFocus();}};this.fnPushConnect=function(){this.XPush00.set_projectid(this.edtProjectName.value);this.XPush00.set_protocolversion(3);this.XPush00.set_iplist(this.edtAddressPort.value);this.XPush00.set_userid(this.edtLoginUserID.value);this.XPush00.connect();};this.fnLoginMessage=function(){this.XPush00.subscribe('CODETYPE','SENDUSER',this,this.dsUserList,"append","fnPushUserCallback");this.XPush00.subscribe('CODEMSG','SENDMSG',this,this.dsReceive,"append","fnPushCallback");this.edtSendMsg.setFocus();var _b="TOPIC_TYPE="+'CODETYPE';_b+=" TOPIC_ID="+'SENDUSER';_b+=" USER_ID="+this.XPush00.userid;_b+=" PROJECT_ID="+this.edtProjectName.value;this.fnCallProvider(_b,'login');};this.fnSendMessage=function(){var _b=this.edtSendMsg.value;this.createMessage('send',_b);this.edtSendMsg.set_value("");this.edtSendMsg.setFocus();var _c="TOPIC_TYPE="+'CODEMSG';_c+=" TOPIC_ID="+'SENDMSG';_c+=" USER_ID="+this.edtLoginUserID.value;_c+=" PROJECT_ID="+this.edtProjectName.value;_c+=" SEND_MESSAGE="+_b;this.fnCallProvider(_c,'send');};this.fnReceiveMessage=function(_b){var _c=this.dsReceive.getColumn(_b,'MSG');var _d=this.dsReceive.getColumn(_b,'USER');if(_d!=this.XPush00.userid){this.createMessage('receive',_c);}};this.nTop=5;this.nLeft=5;this.nRight=5;this.nCount=0;this.createMessage=function(_b,_c){var _d=this.divContents.getOffsetWidth()-20;var _e=20;if(_b=='send'||_b=='login'){this.nLeft=null;this.nRight=5;}else{this.nLeft=5;this.nRight=null;}var _f="stMessage"+this.nCount;var _g=new Static();_g.init(_f,this.nLeft,this.nTop,_d,_e,this.nRight,null);_g.set_fittocontents('both');_g.set_text(_c);_g.set_wordWrap('char');_g.set_border('1px solid #d5d5d5');_g.set_borderRadius('5px');_g.set_padding('5px');this.divContents.addChild(_f,_g);_g.show();var _h=_g.getOffsetWidth();var _i=350;var _j=_g.getOffsetHeight();if(_i<_h){_g.set_fittocontents('none');_g.setOffsetWidth(_i);var _k=nexacro.ceil(_j/_i);_j+=16* _k;_g.setOffsetHeight(_j);}this.nTop+=_j+3;this.nCount++ ;this.divContents.form.resetScroll();return _g;};});this.on_initEvent=function(){this.addEventHandler("onload",this.form_onload,this);this.edtSendMsg.addEventHandler("onkeydown",this.edtSendMsg_onkeydown,this);this.edtLoginUserID.addEventHandler("onkeydown",this.edtLoginUserID_onkeydown,this);this.btnOk.addEventHandler("onclick",this.btnOk_onclick,this);this.btnSend.addEventHandler("onclick",this.btnSend_onclick,this);this.XPush00.addEventHandler("onkeepalive",this.XPush00_onkeepalive,this);this.XPush00.addEventHandler("onsuccess",this.XPush00_onsuccess,this);this.XPush00.addEventHandler("onerror",this.XPush00_onerror,this);};this.loadIncludeScript("XPush_RealTimeChat.xfdl");this.loadPreloadList();_a=null;};})();