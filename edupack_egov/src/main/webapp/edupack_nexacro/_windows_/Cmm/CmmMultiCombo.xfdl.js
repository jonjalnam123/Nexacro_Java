(function(){return function(){if(!this._is_form){return;}var _a=null;this.on_create=function(){this.set_name("CmmMultiCombo");this.set_titletext("멀티콤보");if(Form==this.constructor){this._setFormPosition(200,28);}_a=new Dataset("dsCbo",this);_a._setContents("");this.addChild(_a.name,_a);_a=new Edit("edtCbo","0","0",null,"28","29",null,null,null,null,null,this);_a.set_taborder("0");_a.set_enable("true");_a.set_readonly("true");_a.set_background("white");this.addChild(_a.name,_a);_a=new Button("btnCbo",null,"0","28","28","2",null,null,null,null,null,this);_a.set_taborder("1");_a.set_cssclass("btn_WF_MultiCombo");this.addChild(_a.name,_a);_a=new PopupDiv("pdvCbo","0","29",null,"129","0",null,null,null,null,null,this);_a.set_text("");_a.set_visible("false");_a.set_cssclass("pdiv_WF_MultiCombo");this.addChild(_a.name,_a);_a=new Layout("default","",0,0,this.pdvCbo.form,function(_b){});this.pdvCbo.form.addLayout(_a.name,_a);_a=new Layout("default","",200,28,this,function(_b){});this.addLayout(_a.name,_a);};this.loadPreloadList=function(){};this.registerScript("CmmMultiCombo.xfdl",function(){this._objBindDs;this._objTarget;this.comboinnerdataset;this.combocodecolumn;this.combodatacolumn;this.allcheck;this.callbackfunc;this.maxcount;this.fvTerm=3;this.fvBottomTerm=12;this.fvWidth=0;this.fvBtnWidth=43;this.fvBtnHeight=23;this.fvRowHeight=30;this.objApp=this.gfnGetApplication();this.form_onload=function(_a,_b){this.fvWidth=this.pdvCbo.getOffsetWidth();this.fnSetMultiCombo();};this.fnSetMultiCombo=function(){var _b=this.parent;this.comboinnerdataset=_b.comboinnerdataset;this.combocodecolumn=_b.combocodecolumn;this.combodatacolumn=_b.combodatacolumn;this.allcheck=_b.allcheck;this.callbackfunc=_b.callbackfunc;this.maxcount=_b.maxcount;if(this.gfnIsNull(this.combocodecolumn)){return false;}if(this.gfnIsNull(this.combodatacolumn)){return false;}if(this.gfnIsNull(this.allcheck)){this.allcheck="false";}if(this.gfnIsNull(this.maxcount)){this.maxcount=5;}};this.fnSetDataset=function(_b){this._objBindDs=_b;this.dsCbo.clear();this.dsCbo.addColumn("multiComboChk","STRING");this.dsCbo.addColumn(this.combocodecolumn,"STRING");this.dsCbo.addColumn(this.combodatacolumn,"STRING");_b.set_enableevent(false);for(var _h=0;_h<_b.getRowCount();_h++ ){this.dsCbo.addRow();this.dsCbo.setColumn(_h,"multiComboChk","0");this.dsCbo.setColumn(_h,this.combocodecolumn,_b.getColumn(_h,this.combocodecolumn));this.dsCbo.setColumn(_h,this.combodatacolumn,_b.getColumn(_h,this.combodatacolumn));}_b.set_enableevent(true);var _c=this.pdvCbo;var _d=this.maxcount;var _e=this.dsCbo.getRowCount();if(_d>_e){_d=_e;}var _f=_f=this.fvRowHeight* _d+nexacro.toNumber(_d)+1;if(this.allcheck=="true"){var _g=this.fvBtnHeight+(this.fvBottomTerm* 2);_f+=_g;this.pdvCbo.set_height(_f);this._fnMakeAllCheck();}else{_f+=this.fvTerm;this.pdvCbo.set_height(_f);this._fnMakeCombo(_c);}};this._fnMakeAllCheck=function(){var _b=new Div("divComboList",0,0,null,null,0,this.fvBtnHeight+(this.fvBottomTerm* 2));this.pdvCbo.addChild(_b.name,_b);_b.show();var _c=(nexacro.toNumber(this.fvWidth)-(this.fvBtnWidth* 2+this.fvTerm))/2;var _d=new Button("btnAllCheck",_c,null,this.fvBtnWidth,this.fvBtnHeight,null,this.fvBottomTerm);this.pdvCbo.addChild(_d.name,_d);_d.addEventHandler("onclick",this._compBtnAllCheck_onclick,this);_d.set_cssclass("btn_POP_Btn");_d.set_text("All");_d.show();var _e=new Button("btnNonCheck",_c+this.fvBtnWidth+this.fvTerm,null,this.fvBtnWidth,this.fvBtnHeight,null,this.fvBottomTerm);this.pdvCbo.addChild(_e.name,_e);_e.set_cssclass("btn_POP_Btn");_e.set_text("No");_e.addEventHandler("onclick",this._compBtnNonCheck_onclick,this);_e.show();this._fnMakeCombo(_b);};this._fnMakeCombo=function(_b){if(_b.form.isValidObject("grdCbo")){var _c=_b.form.components["grdCbo"];_b.removeChild("grdCbo");_c.destroy();_c=null;}var _d=0;if(this.allcheck=="true"){_d=0;}else{_d=this.fvTerm;}var _e=new Grid("grdCbo",this.fvTerm,this.fvTerm,null,null,this.fvTerm,_d);_e.set_cssclass("grd_WF_Detail");_b.addChild(_e.name,_e);_e.set_enableevent(false);_e.set_enableredraw(false);_e.set_binddataset(this.dsCbo);_e.set_autofittype("col");_e.set_wheelscrollrow(1);_e.createFormat();_e.deleteContentsRow("head",0);_e.setFormatRowProperty(0,"size",this.fvRowHeight);_e.setCellProperty("Body",0,"displaytype","checkboxcontrol");_e.setCellProperty("Body",0,"edittype","checkbox");_e.setFormatColProperty(0,"size",24);_e.setFormatColProperty(0,"band","left");_e.show();_e.addEventHandler("oncellclick",this._Grid_oncellclick,this);_e.set_enableevent(true);_e.set_enableredraw(true);this.edtCbo.set_value("선택");};this.fnOpenCombo=function(){var _b=this.objApp.mainframe.height;if(!this.gfnIsNull(this.comboinnerdataset)){if(this.gfnIsNull(this._objBindDs)){trace("invalid comboinnerdataset");}else{var _c=21;var _d=nexacro.toNumber(_b)-nexacro.toNumber(this.getOffsetBottom());var _e=nexacro.toNumber(this.pdvCbo.height)+nexacro.toNumber(this.btnCbo.height)+4;if(_e>_d){_c= -(this.pdvCbo.height-1);}this.pdvCbo.trackPopupByComponent(this.edtCbo,0,_c);this._objBindDs.set_rowposition( -1);}}};this.fnInit=function(_b){this._objTarget=_b;var _c=this.dsCbo;for(var _d=0;_d<_c.rowcount;_d++ ){_c.setColumn(_d,"multiComboChk","0");}this.edtCbo.set_value("선택");};this.getValue=function(){return this.edtCbo.retrunvalue;};this.getText=function(){return this.edtCbo.returntext;};this.setValue=function(_b){this.fnInit();var _c=_b.split(",");var _d=[];var _e=this._objBindDs;var _f;for(var _g=0;_g<_c.length;_g++ ){_f=_e.findRow(this.combocodecolumn,_c[_g]);if(_f!= -1){_d.push(_e.getColumn(_f,this.combodatacolumn));_e.setColumn(_f,"multComboChk","1");}}this.fnSetComboText(_d,_c);};this.fnSetComboText=function(_b,_c){var _d=_b.toString();this.edtCbo.retrunvalue=_c.toString();this.edtCbo.returntext=_d;var _e=nexacro.getTextSize(_d,"9 Dotum");var _f=_e.nx;var _g=this.edtCbo.getOffsetWidth()-this.btnCbo.width;if(_f>_g){this.edtCbo.set_value(_b.length+"개 선택");this.edtCbo.set_tooltiptext(_d);this.edtCbo.set_tooltiptype("hover");}else{this.edtCbo.set_value(_d);}if(this.gfnIsNull(_b)){this.edtCbo.set_value("선택");}};this.setValue=function(_b){if(this.gfnIsNull(_b)){return;}var _c=_b.split(",");var _d=[];var _e;this.fnInit();for(var _f=0;_f<_c.length;_f++ ){_e=this.dsCbo.findRow(this.combocodecolumn,_c[_f]);if(_e!= -1){_d.push(this.dsCbo.getColumn(_e,this.combodatacolumn));this.dsCbo.setColumn(_e,"multiComboChk","1");}}this.fnSetComboText(_d,_c);};this.fnSetRequired=function(_b){if(_b){this.edtCbo.set_background("yellow");}else{this.edtCbo.set_background("white");}};this._compBtnAllCheck_onclick=function(){for(var _b=0;_b<this.dsCbo.rowcount;_b++ ){this.dsCbo.setColumn(_b,"multiComboChk","1");}};this._compBtnNonCheck_onclick=function(){for(var _b=0;_b<this.dsCbo.rowcount;_b++ ){this.dsCbo.setColumn(_b,"multiComboChk","0");}};this.btnCombo_onclick=function(_a,_b){this.fnOpenCombo();};this.edtCombo_oneditclick=function(_a,_b){this.fnOpenCombo();};this.pdvCombo_oncloseup=function(_a,_b){var _c=[];var _d=[];if(this.gfnIsNull(this.dsCbo.getColumnInfo(this.combodatacolumn))){trace("comboinnerdataset("+this.dsCbo.name+")에 컬럼("+this.combodatacolumn+")이 존재하지 않습니다.\ncombodatacolumn 정보를 확인하세요.");return false;}if(this.gfnIsNull(this.dsCbo.getColumnInfo(this.combocodecolumn))){trace("comboinnerdataset("+this.dsCbo.name+")에 컬럼("+this.combocodecolumn+")이 존재하지 않습니다.\combocodecolumn 정보를 확인하세요.");return false;}for(var _e=0;_e<this.dsCbo.getRowCount();_e++ ){if(this.dsCbo.getColumn(_e,"multiComboChk")=="1"){_c.push(this.dsCbo.getColumn(_e,this.combodatacolumn));_d.push(this.dsCbo.getColumn(_e,this.combocodecolumn));}}this.fnSetComboText(_c,_d);if(!this.gfnIsNull(this.callbackfunc)){this.lookupFunc(this.callbackfunc).call(this.parent.name);}};this._Grid_oncellclick=function(_a,_b){var _c=_a.getBindDataset();if(_b.col!=0){if(_c.getColumn(_b.row,"multiComboChk")=="1"){_c.setColumn(_b.row,"multiComboChk","0");}else{_c.setColumn(_b.row,"multiComboChk","1");}}if(!this.gfnIsNull(this.maxcount)){var _d=_c.getCaseCount("multiComboChk == '1'");if(this.maxcount<_d){_c.setColumn(_b.row,"multiComboChk","0");var _e=[];_e.push(this.maxcount);this.gfnAlert("msg.err.validator.multicombo.maxcnt",_e);}}};});this.on_initEvent=function(){this.addEventHandler("onload",this.form_onload,this);this.edtCbo.addEventHandler("oneditclick",this.edtCombo_oneditclick,this);this.btnCbo.addEventHandler("onclick",this.btnCombo_onclick,this);this.pdvCbo.addEventHandler("oncloseup",this.pdvCombo_oncloseup,this);};this.loadIncludeScript("CmmMultiCombo.xfdl");this.loadPreloadList();_a=null;};})();